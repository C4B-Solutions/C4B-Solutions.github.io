!function(e){function t(e,t){var o=L.popup({minHeight:600,minWidth:800}).setLatLng(e.getLatLng()).setContent(t);e.bindPopup(o).openPopup().togglePopup()}function o(e,t){var o=L.marker(t),i=o.bindPopup(e?"Error: The Geolocation service failed.":"Error: Your browser doesn't support geolocation.");o.addTo(l),i.openPopup()}function i(e,t){return new L.LatLng(e,t)}function n(e,t){if(e===Number.MAX_VALUE)return'<div class="markerInfoWindowGuest"><div class="inline gravatarGuest" /><div class="inline gravatarInfoGuest"><div class="markerInfo">'+t.person+'</div><div class="adressInfo">'+t.address+"</div></div></div>";for(var o="",i=0;i<t.family_members.length;i++){o+=function(e,t){return'<div class="familyMember" style="top:10px; left:-1px"><div class="gravatarFamilyMember" style="background-image:url(\''+c+"images/family_faces/"+e.friendly_image+'\')" /><div class="gravatarInfo"><div class="markerInfo">'+e.friendly_name+'</div><div class="adressInfo">'+e.friendly_description+"</div></div></div>"}(t.family_members[i])}return'<div class="markerInfoWindow"><div class="family" style="height:'+(11.1*t.family_members.length+6.3)+'em"><div class="familyInfo">'+t.family_description+'</div><div class="familyMembers" style="height:'+10*t.family_members.length+'em">'+o+"</div></div></div>"}function r(e,t,o){return new L.Marker(t,{icon:new m({iconUrl:o?u:d}),title:e.replace("<br />","\r\n").replace("<br/>","\r\n").replace("<br>","\r\n"),draggable:!1,bounceOnAdd:!0,bounceOnAddOptions:{duration:4e3,height:500,loop:2},bounceOnAddCallback:function(){}}).addTo(l)}function a(e){l.setView(e.getLatLng(),l.getZoom())}function s(e){navigator.geolocation?(b.locationAddressCallback=e,navigator.geolocation.getCurrentPosition(function(e){function o(e,i){function r(i,r){if(i)o(this.originalSource.marker,this.originalSource.userClientGeoPosition);else{a.userLocationDetails.formatted_address=r.address.LongLabel||r.address.Match_addr;var s=n(Number.MAX_VALUE,{person:v+y,address:a.userLocationDetails.formatted_address});b.locationAddressCallback(a.userLocationDetails.formatted_address),t(e,s)}}var a={originalSource:{marker:e,userClientGeoPosition:i},input:i,userLocationDetails:{formatted_address:"",city:{},city_display_name:""},output:function(){return r.bind(this)}};r.bind(a),L.esri.Geocoding.geocodeService().reverse().latlng([a.input.coords.latitude,a.input.coords.longitude]).run(a.output())}var s=i(e.coords.latitude,e.coords.longitude),l=r(v,s,!0);o(l,e),a(l)},function(){var e=s.bind(null,b.locationAddressCallback);setTimeout(e,500)})):o(!1,l.getCenter())}var l,c,d,u,m,f,g=[],p=!1,h="",v="Me",y=" [ browser thinks that ]",_=" [ this is where I live actually ! ]",b={locationAddressCallback:null},w="init",A={currentState:"",callback:null,onAllLayerTilesBeingLoadedAndVisible:function(){A.currentState===w&&(navigator.geolocation?setTimeout(function(){for(var e=0;e<g.length;e++)!function(e,o){var s=r(e.family_description,i(e.family_location_coords.lat,e.family_location_coords.lng),!1);t(s,n(o,e)),a(s)}(g[e],e)},0):o(!1,l.getCenter()),A.callback())},switchToInit:function(){this.currentState=w}};this.__init__=function(e,t,o){return function(e,t,o){f=t,h=o,d=(c=e)+"images/map_location_icons/home.png",u=c+"images/map_location_icons/visitor.png",m=L.Icon.extend({options:{iconSize:[32,32],popupAnchor:[0,-10]}})}(e,t,o)},this.loadMapCriticalData=function(e){return function(e){return function(e){for(var t=f.split("},"),o=t.length,i=0;i<o;i++){for(var n=t[i].replace("{","").replace("}","").split("\n"),r=(n=function(e){for(var t=[],o=-1,i=0;i<e.length;i++)(function(e){return 0!=e.length&&(1!=e.length||13!=e.charCodeAt(0)&&10!=e.charCodeAt(0))})(e[i])&&(t.push(null),t[o+=1]=e[i]);return t}(n)).length,a={family_description:"",family_location_address:"",family_location_coords:{},family_members:[]},s=0;s<r;s++)if(0==s){var l=n[s].split(";");a.family_description=l[0].trim(),a.family_location_address=l[1].trim()}else{var c={friendly_name:"",friendly_description:"",friendly_image:""},d=n[s].split(";");c.friendly_name=d[0].trim(),c.friendly_description=d[1].trim(),c.friendly_image=d[2].trim(),a.family_members.push(c)}g.push(a)}e()}(e)}(e)},this.geocodeAddress=function(e){return function(e){if(0==g.length)throw new Error("Invoking this method = [geocodeAddressCollection_I_1L] makes sense if user critical data was previously loaded into application.");!function(){function t(i){function n(i,n,r){if(i)t(this.originalSource);else{var a=function(e){for(var t,o=0,i=0;i<e.length;i++){var n=e[i];n.score>o&&(o=n.score,t=n)}return t}(n.results);!function(t,i){for(var n=0;n<g.length;n++){var r=g[n];if(r.family_location_address===t){if(r.family_location_coords=i.latlng,!o.completeAndCheck())break;p=!0,e()}}}(this.input,a)}}var r={originalSource:i,input:i.family_location_address,output:function(){return n.bind(this)}};n.bind(r),L.esri.Geocoding.geocode().text(r.input).run(r.output())}for(var o={size:g.length,completed:0,completeAndCheck:function(){return this.completed++,this.completed===this.size}},i=0;i<g.length;i++)t(g[i])}()}(e)},this.initMap=function(e){return function(e){if(0==g.length||!p)throw new Error("Invoking this method = [initMap_I_1L] makes sense if user critical data was previously loaded into application and geocoded.");var t={OpenStreetMap:new L.TileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> Contributors',maxZoom:10}),"World Imagery":new L.TileLayer("http://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",{attribution:"Tiles &copy; Esri &mdash; Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community",maxZoom:10}),"Google Maps - Streets":new L.TileLayer("https://{s}.google.com/vt/lyrs=m&x={x}&y={y}&z={z}",{maxZoom:10,subdomains:["mt0","mt1","mt2","mt3"]}),"Google Maps - Hybrid":new L.TileLayer("http://{s}.google.com/vt/lyrs=s,h&x={x}&y={y}&z={z}",{maxZoom:10,subdomains:["mt0","mt1","mt2","mt3"]}),"Google Maps - Satellite":new L.TileLayer("http://{s}.google.com/vt/lyrs=s&x={x}&y={y}&z={z}",{maxZoom:10,subdomains:["mt0","mt1","mt2","mt3"]}),"Google Maps - Terrain":new L.TileLayer("http://{s}.google.com/vt/lyrs=p&x={x}&y={y}&z={z}",{maxZoom:10,subdomains:["mt0","mt1","mt2","mt3"]})};!function(t){A.switchToInit();for(var o in t)t[o].on("load",A.onAllLayerTilesBeingLoadedAndVisible);A.callback=e}(t);var o={center:{lat:g[0].family_location_coords.lat,lng:g[0].family_location_coords.lng},zoom:7,zoomControl:!1,layers:[t.OpenStreetMap]};l=new L.Map(document.getElementsByClassName(h)[0],o),L.control.layers(t).addTo(l),L.control.zoom({position:"topright"}).addTo(l),l.on("baselayerchange",function(){l.eachLayer(function(e){e instanceof L.Marker&&l.getBounds().contains(e.getLatLng())&&l.removeLayer(e)})})}(e)},this.initializeGuestLocation=function(e){return function(e){f=e}(e)},this.geocodeGuestAddress=function(){return function(){if(!f)throw new Error("Invoking this method = [geocodeGuestAddress_I_1L] makes sense if guest critical data (location address) was previously loaded into application.");!function(){function e(o){function i(o,i,s){o?e(this.originalSource):function(e){var o=e.latlng,i=r(v,o,!0);t(i,n(Number.MAX_VALUE,{person:v+_,address:f})),a(i)}(function(e){for(var t,o=0,i=0;i<e.length;i++){var n=e[i];n.score>o&&(o=n.score,t=n)}return t}(i.results))}var s={originalSource:o,input:o,output:function(){return i.bind(this)}};i.bind(s),L.esri.Geocoding.geocode().text(s.input).run(s.output())}e(f)}()}()},this.showGuestLocation=function(e){return s(e)},this.getProviderName=function(){return"leaflet"},e.leafletMapDriver=e.leafletMapDriver||this}(window);